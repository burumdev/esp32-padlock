# ESP32 Padlock

Securely lock and unlock your esp32-cX device over an encrypted web endpoint.

## Description

This app can be used as a template for building web-authorized embedded applications for esp32-cX series of IoT chips.
It serves web pages `locked.html` for a locked device and `unlocked.html` for unlocked.
The user can enter a password to a web form on these pages to lock or unlock the device.

## Memory hog

The app is a memory hog for c3 devices and barely survives the ordeal of serving https pages, locking unlocking etc.
It should work much better on a c6 or newer device with 512kb+ RAM.

## Encryption engine

Mbed-TLS C library is used for https. esp-mbedtls wrapper included uses FFI bindings to the library.
As esp-mbedtls is experimental and currently not published to crates.io, we have to use a cloned version.
Something native like [embedded-tls](https://crates.io/crates/embedded-tls) can be used in the future if it saves some memory resources and works as fast.

## Setup

To setup the app with your device:
* Generate TLS certificates with the .pem format and put them into the `certs` directory in the project root.
The file names are: `cert.pem` for public key and `key.pem` for private key. I highly recommend using [mkcert](https://github.com/FiloSottile/mkcert)
for development purposes. This will install a certificate authority to the system that's accepted both by your system and web browsers.
Certificates generated by a known signing entity can later be used for production.
* Rename `config.toml.example` file in `.cargo` directory to `config.toml`.
Edit this file with your Wifi credentials, static ip for the device from your network and a custom device password for locking-unlocking the device.
* Edit the `locked.html` and `unlocked.html` however you want to reflect your style and wording.

## Building

* You'll need Rust build target for RISC-V esp32 processors. It's `riscv32imc-unknown-none-elf` for esp32-c3 and can be something different for other chips.
* esp-mbedtls shipped uses a prebuilt version of mbedtls C library, so you won't normally need C build targets.
* To build and run as production:

```bash
cargo run -r
```

## License
[MIT](https://choosealicense.com/licenses/mit/)

## License of esp-mbedtls

`esp-mbedtls` and `esp-mbedtls-sys` both are licensed under MIT or APACHE2.0.
See LICENSE files in these directories for details.

## Contributing

Pull requests are welcome. For major changes, please open an issue first
to discuss what you would like to change.
